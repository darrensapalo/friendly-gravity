<html>
<head>

<style>
@font-face {
    font-family: 'digital_techregular';
    src: url('font/space_age_2.eot');
    src: url('font/space_age_2.eot?#iefix') format('embedded-opentype'),
         url('font/space_age_2.woff') format('woff'),
         url('font/space_age_2.ttf') format('truetype'),
         url('font/space_age_2.svg#cyberspaceregular') format('svg');
    font-weight: normal;
    font-style: normal;
}

body { background-color: #000000; }
</style>
	
	<script src="classes/imageutil.js" type="text/javascript"></script>
	<script src="classes/sprite.js" type="text/javascript"></script>
	<script src="classes/resources.js" type="text/javascript"></script>
	<script src="classes/game.js" type="text/javascript"></script>

	<script src="classes/GameScreen.js" type="text/javascript"></script>
	<script src="classes/GameOverScreen.js" type="text/javascript"></script>
	<script src="classes/MainMenuScreen.js" type="text/javascript"></script>
	<script src="classes/ShopScreen.js" type="text/javascript"></script>
	<script src="classes/TutorialScreen.js" type="text/javascript"></script>
	<script src="classes/AboutScreen.js" type="text/javascript"></script>
	<script src="classes/DevelopScreen.js" type="text/javascript"></script>

	
	<script src="classes/comet.js" type="text/javascript"></script>
	<script src="classes/player.js" type="text/javascript"></script>
	<script src="classes/Trail.js" type="text/javascript"></script>
	<script src="classes/Planet.js" type="text/javascript"></script>
	
	<script>
	var font = "digital_techregular";
	var fontsize = "20px";

	/*
		Bar (timer)
		earth spawning
		Effects:
			More points
			Slower stars
			Increase star spawning (2 levels)
			Shorter cooldowns for shockwave
			Longer gameplay



		Darren todo list:
			- Sound effect of shockwave : almost done 
			- 
			- 




	*/
		var myGame = new Game("blackhole", resourceList);
		
		var backgroundMusic = new Audio("assets/audio/new bgm.mp3"); // buffers automatically when created
		var vortexSFX = new Audio("assets/audio/sfxvortex.mp3"); // buffers automatically when created
		var shockwaveSFX = new Audio("assets/audio/shockwave.mp3"); // buffers automatically when created
		var redColor = "#CC0000";
		

		backgroundMusic.volume = 1;
		vortexSFX.volume = 0.13;
		backgroundMusic.loop = true;

		var DISABLE_MUSIC = false;
		
		var KEY_LEFT=37, KEY_RIGHT=39, KEY_UP=38, KEY_DOWN=40, KEY_SPACE=32, KEY_M = 77, KEY_ENTER = 13;
		var isUp = false, isDown = false, isLeft = false, isRight=false, isSpace=false, isMusic = false, isToggleMusic = true, isEnter = false;

		var DECREASE_SCORE = 50;

		
		var changeScreenOpacity = 0;

		myGame.InitGame = function () {
			window.onkeydown = handleKeydown;
			window.onkeyup = handleKeyup;
			window.onmousemove = handleMouseMove;
			
				myGame.Load();

			myGame.gameScreen.Initialize();
			myGame.mainMenuScreen.Initialize();
			myGame.shopScreen.Initialize();
			myGame.tutorialScreen.Initialize();
			myGame.aboutScreen.Initialize();
			myGame.developScreen.Initialize();

			myGame.currentScreen = myGame.mainMenuScreen;

			
			myGame.mousex = myGame.mousey = 0;
			
			myGame.displayCometTrail = true;

			// myGame.ResetData();

			if (!DISABLE_MUSIC && (isMusic = myGame.hasSounds)) backgroundMusic.play();

			}
			
		
		myGame.Quit = function () {
			if ("localStorage" in window && window["localStorage"] != null) {
				localStorage["goodblackhole.highscore"] = parseInt(myGame.highScore);
				localStorage["goodblackhole.cash"] = parseInt(myGame.cash);

				localStorage["goodblackhole.shockwavecd"] = parseInt(myGame.shockwavecd);
				localStorage["goodblackhole.difficulty"] = parseInt(myGame.difficulty);
				localStorage["goodblackhole.pointsRange"] = parseFloat(myGame.pointsRange);
				localStorage["goodblackhole.gameDuration"] = parseInt(myGame.gameDuration);
				localStorage["goodblackhole.starMovementSpeed"] = parseFloat(myGame.starMovementSpeed);

				localStorage["goodblackhole.hasSounds"] = myGame.hasSounds;
			}
		}
		
		myGame.Load = function () {
			if ("localStorage" in window && window["localStorage"] != null) {
				if (typeof(localStorage["goodblackhole.highscore"]) != "NaN" && localStorage["goodblackhole.highscore"] != "NaN")
					myGame.highScore = parseInt(localStorage["goodblackhole.highscore"]);
				else
					myGame.highScore = 0;
				if (typeof(localStorage["goodblackhole.cash"]) != "undefined" && localStorage["goodblackhole.cash"] != "NaN")
					myGame.cash = parseInt(localStorage["goodblackhole.cash"]);
				else
					myGame.cash = 0;


				// Shockwave cooldown 
				if (typeof(localStorage["goodblackhole.shockwavecd"]) != "undefined" && localStorage["goodblackhole.shockwavecd"] != "NaN")
					myGame.baseShockwaveCooldown = parseInt(localStorage["goodblackhole.shockwavecd"]);
				else
					myGame.baseShockwaveCooldown = 10000;

				// Difficulty level
				if (typeof(localStorage["goodblackhole.difficulty"]) != "undefined" && localStorage["goodblackhole.difficulty"] != "NaN")
					myGame.difficulty = parseInt(localStorage["goodblackhole.difficulty"]);
				else
					myGame.difficulty = 0;

				// Range of points increased
				if (typeof(localStorage["goodblackhole.pointsRange"]) != "undefined" && localStorage["goodblackhole.pointsRange"] != "NaN")
					myGame.pointsRange = parseFloat(localStorage["goodblackhole.pointsRange"]);
				else
					myGame.pointsRange = 0.25;

				// Duration of gameplay increased
				if (typeof(localStorage["goodblackhole.gameDuration"]) != "undefined" && localStorage["goodblackhole.gameDuration"] != "NaN")
					myGame.gameDuration = parseInt(localStorage["goodblackhole.gameDuration"]);
				else
					myGame.gameDuration = 30;


				// Movement speed of stars is decreased
				if (typeof(localStorage["goodblackhole.starMovementSpeed"]) != "undefined" && localStorage["goodblackhole.starMovementSpeed"] != "NaN")
					myGame.starMovementSpeed = parseFloat(localStorage["goodblackhole.starMovementSpeed"]);
				else
					myGame.starMovementSpeed = 0.01;

				// Movement speed of stars is decreased
				if (typeof( localStorage["goodblackhole.hasSounds"]) != "undefined" && localStorage["goodblackhole.hasSounds"] != "NaN")
					myGame.hasSounds = (localStorage["goodblackhole.hasSounds"] == "true") ? true : false;
				else
					myGame.hasSounds = true;
			}
		}
		
		myGame.ResetData = function () {
			myGame.cash = 0;
			myGame.highScore = 0;

			myGame.baseShockwaveCooldown = 10000;
			myGame.difficulty = 0;
			myGame.pointsRange = 0.25;
			myGame.gameDuration = 30;
			myGame.starMovementSpeed = 0.01;
			myGame.hasSounds = true;
			myGame.Quit();
		}
		

		myGame.Draw = function (context) {
			myGame.ClearScreen("#FFFFFF");
			myGame.currentScreen.Draw(context);
			if (myGame.transferringScreens){
				context.globalAlpha = changeScreenOpacity;
				context.fillStyle = blackColor;
				context.fillRect(0,0,800,480);
				context.globalAlpha = 1;
			}
			
			
			
		}
		myGame.Update = function () {
			myGame.currentScreen.Update();
			myGame.UpdateScreenChangeHandler();
			myGame.checkMusic();
		}

		myGame.checkMusic = function() {
			// isMusic = myGame.hasSounds;

			if (DISABLE_MUSIC) return;

			if (isMusic && isToggleMusic == false){
				myGame.hasSounds = !myGame.hasSounds;
				isToggleMusic = true;
			}

			if (myGame.hasSounds)
				backgroundMusic.play();
			else
				backgroundMusic.pause();
		}
		
		function handleMouseMove(evt)
		{
			myGame.mousex = evt.x;
			myGame.mousey = evt.y;
		}
		
		function handleKeydown(evt) {
			switch(evt.keyCode) {
				case KEY_LEFT: isLeft =true;break;
				case KEY_RIGHT: isRight =true;break;
				case KEY_UP: isUp =true;break;
				case KEY_DOWN: isDown =true;break;
				case KEY_SPACE: isSpace = true; break;
				case KEY_M: isMusic = true; isToggleMusic = false; break;
				case KEY_ENTER: isEnter = true; break;
			}
		}
		
		function handleKeyup(evt) {
			switch(evt.keyCode) {
				case KEY_LEFT: isLeft =false;break;
				case KEY_RIGHT: isRight =false;break;
				case KEY_UP: isUp =false;break;
				case KEY_DOWN: isDown =false;break;
				case KEY_SPACE: isSpace = false; break;
				case KEY_M: isMusic = isToggleMusic = false; break;
				case KEY_ENTER: isEnter = false; break;
			}
		}
		
	</script>
</head>
<body>
<div id="page">
	<canvas id="blackhole" width="800" height="480" style="border: 1px solid black"></canvas>
</div>

<script> myGame.Start(); </script>
</body>

</html>